import{r as u}from"./validators-dea6e3a5.js";import{q as de,L as ue,a4 as pe,s as S,t as w,r as g,a as ce,o as p,f as c,e as i,b as l,d as m,E as v,z as a,ag as $,a1 as B,H as k,a2 as I,D as Y,G as V}from"./index-670bda14.js";import{_ as me}from"./AppDateTimePicker-0ecee459.js";import{_ as ve}from"./AppTextField-803105de.js";import{_ as Ve}from"./AppSelect-b4b316a2.js";import{_ as fe}from"./DialogCloseBtn-07a65624.js";import{_ as be}from"./Loading-0e8ee1a0.js";import{h as K}from"./moment-a9aaa855.js";import{a as n,V as A}from"./VRow-44af3a5b.js";import{V as F}from"./VCardText-83b6dd60.js";import{V as Q}from"./VDialog-e50ee805.js";import{V as G}from"./VCard-367227de.js";import{V as W}from"./VDivider-964da8ec.js";import{V as X}from"./VForm-e3bcef70.js";import{V as _e}from"./VDataTable-674b624c.js";import{V as ge}from"./VImg-4f1dd734.js";import{V as N}from"./VChip-c9c9bc7b.js";import{V as Z}from"./VTooltip-4a06c0c7.js";import"./helpers-61e4df1a.js";import"./VField-eebd85ff.js";import"./focus-bfe812d1.js";import"./easing-9f15041e.js";import"./VInput-28c68c55.js";import"./form-f40ca62b.js";import"./VTextField-babd124d.js";/* empty css                   */import"./VCounter-40602143.js";import"./forwardRefs-8348545e.js";import"./VSelect-80bd1ff2.js";import"./VList-faf63776.js";import"./ssrBoot-587632ee.js";import"./VAvatar-eedc1aa8.js";import"./dialog-transition-a3b422c0.js";import"./VMenu-cbe945a0.js";import"./VOverlay-9bca4c5f.js";import"./lazy-055ec9ba.js";import"./scopeId-78466d19.js";import"./VCheckboxBtn-770097af.js";import"./VSelectionControl-798a6484.js";import"./VTable-3015d60e.js";import"./filter-9f13f1fe.js";const ye={class:"d-flex align-center"},he={class:"d-flex flex-column ms-3"},ke={class:"d-block font-weight-medium text-truncate text-high-emphasis"},Ce={class:"text-xs"},Me={class:"text-xs"},Ue={class:"text-xs"},qe={class:"text-xs"},Pe={class:"text-xs"},ft={__name:"messages",setup(De){const d=de(),x=ue(),E=pe.useToast();S(()=>document.title="Admin - Popup Messages"),S(()=>d.dispatch("GetPopupMessages")),S(()=>d.dispatch("GetClients"));const R=w(()=>d.state.clients.clients),ee=w(()=>d.state.messages.data),y=w(()=>d.state.messages.loading),te=w(()=>d.state.auth.user),C=JSON.parse(te.value.permissions);S(()=>{var e;(e=C.PopUpMessages)!=null&&e.includes("ReadPopUpMessages")||(alert("You don't have permission to access this resource..."),x.go(-1))});const M=g(null),s=g({client_id:"",content:"",trigger_event:"",visibility_start:"",visibility_end:"",status:""}),U=g(""),f=g(!1),q=g(!1),le=e=>{M.value=e,s.value.client_id=e.client_id,s.value.content=e.content,s.value.trigger_event=e.trigger_event,s.value.visibility_start=e.visibility_start,s.value.visibility_end=e.visibility_end,s.value.status=e.status,q.value=!0},z=()=>{s.value="",M.value=null},ae=[{title:"Client",key:"popup.client"},{title:"Content",key:"popup.content"},{title:"Trigger Event",key:"popup.trigger_event"},{title:"Visibility Start",key:"popup.visibility_start"},{title:"Visibility End",key:"popup.visibility_end"},{title:"Status",key:"popup.status"},{title:"Actions",key:"popup.action",sortable:!1}],b=g(),ie=()=>{var e;(e=b==null?void 0:b.value)==null||e.validate().then(({valid:t})=>{t&&oe()})},se=()=>{var e;(e=b==null?void 0:b.value)==null||e.validate().then(({valid:t})=>{t&&re()})},oe=async()=>{const e=new FormData;e.append("client_id",s.value.client_id),e.append("content",s.value.content),e.append("trigger_event",s.value.trigger_event),e.append("visibility_start",s.value.visibility_start),e.append("visibility_end",s.value.visibility_end),e.append("status",s.value.status);try{const t=await d.dispatch("CreatePopupMessage",e);t.status===200&&(E.success(t.message),d.dispatch("GetPopupMessages"),f.value=!1,s.value="")}catch(t){console.error(t)}},re=async()=>{const e=new FormData;e.append("client_id",s.value.client_id),e.append("content",s.value.content),e.append("trigger_event",s.value.trigger_event),e.append("visibility_start",s.value.visibility_start),e.append("visibility_end",s.value.visibility_end),e.append("status",s.value.status);try{const t=await d.dispatch("UpdatePopupMessage",{id:M.value.id,formData:e});t.status===200&&(E.success(t.message),d.dispatch("GetPopupMessages"),z())}catch(t){console.error(t)}},ne=async e=>{if(confirm("Are you sure to delete ?"))try{const t=await d.dispatch("DeletePopupMessage",e);t.status===200&&(E.error(t.message),d.dispatch("GetPopupMessages"))}catch(t){console.log(t)}},L=["Login","Completing a Task","Billing","Subscription Issue"],O=["Active","InActive","Scheduled"];return(e,t)=>{const j=fe,_=Ve,T=ve,P=me,H=ce("IconBtn");return p(),c(A,null,{default:i(()=>[y.value?(p(),c(be,{key:0})):(p(),c(n,{key:1,cols:"12"},{default:i(()=>[l(G,null,{default:i(()=>[l(F,{style:{"border-bottom":"thin solid rgba(var(--v-border-color), var(--v-border-opacity))"}},{default:i(()=>[l(A,null,{default:i(()=>[l(n,{cols:"8",md:"8"},{default:i(()=>{var o;return[m("h2",null,[v("Popup Messages "),(o=a(C).PopUpMessages)!=null&&o.includes("CreatePopUpMessages")?(p(),c($,{key:0,onClick:t[0]||(t[0]=r=>f.value=!a(f)),rounded:"pill",color:"primary",size:"small",class:"ml-5"},{default:i(()=>[l(B,{start:"",icon:"tabler-plus"}),v(" Create ")]),_:1})):k("",!0),l(Q,{modelValue:a(f),"onUpdate:modelValue":t[8]||(t[8]=r=>I(f)?f.value=r:null),persistent:"",width:"900"},{default:i(()=>[l(j,{onClick:t[1]||(t[1]=r=>f.value=!a(f))}),l(G,{title:"Create PopUp Message"},{default:i(()=>[l(W,{class:"mt-3"}),l(F,null,{default:i(()=>[l(X,{ref_key:"refForm",ref:b,onSubmit:Y(ie,["prevent"])},{default:i(()=>[l(A,null,{default:i(()=>[l(n,{cols:"12",md:"4"},{default:i(()=>[l(_,{modelValue:a(s).client_id,"onUpdate:modelValue":t[2]||(t[2]=r=>a(s).client_id=r),items:R.value,"item-title":"email","item-value":"id",label:"Client","prepend-inner-icon":"tabler-user","persistent-placeholder":"",placeholder:"Choose..",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","items","rules"])]),_:1}),l(n,{cols:"12",md:"4"},{default:i(()=>[l(T,{modelValue:a(s).content,"onUpdate:modelValue":t[3]||(t[3]=r=>a(s).content=r),"prepend-inner-icon":"tabler-note",placeholder:"Content","persistent-placeholder":"",label:"Content",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12",md:"4"},{default:i(()=>[l(_,{modelValue:a(s).trigger_event,"onUpdate:modelValue":t[4]||(t[4]=r=>a(s).trigger_event=r),items:L,"prepend-inner-icon":"tabler-color-picker",label:"Trigger Event",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12",md:"4"},{default:i(()=>[l(P,{modelValue:a(s).visibility_start,"onUpdate:modelValue":t[5]||(t[5]=r=>a(s).visibility_start=r),"prepend-inner-icon":"tabler-calendar-check",placeholder:"Visibility Start","persistent-placeholder":"",label:"Visibility Start",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12",md:"4"},{default:i(()=>[l(P,{modelValue:a(s).visibility_end,"onUpdate:modelValue":t[6]||(t[6]=r=>a(s).visibility_end=r),"prepend-inner-icon":"tabler-calendar-check",placeholder:"Visibility End","persistent-placeholder":"",label:"Visibility End",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12",md:"4"},{default:i(()=>[l(_,{modelValue:a(s).status,"onUpdate:modelValue":t[7]||(t[7]=r=>a(s).status=r),items:O,"prepend-inner-icon":"tabler-color-picker",label:"Status",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12"},{default:i(()=>[l($,{type:"submit",disabled:y.value},{default:i(()=>[v(V(y.value?"Creating...":"Create"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(M)!==null?(p(),c(Q,{key:1,modelValue:a(q),"onUpdate:modelValue":t[16]||(t[16]=r=>I(q)?q.value=r:null),persistent:"",width:"900"},{default:i(()=>[l(j,{onClick:t[9]||(t[9]=r=>z())}),l(G,{title:"Update PopUp Message"},{default:i(()=>[l(W,{class:"mt-3"}),l(F,null,{default:i(()=>[l(X,{ref_key:"refForm",ref:b,onSubmit:Y(se,["prevent"])},{default:i(()=>[l(A,null,{default:i(()=>[l(n,{cols:"12",md:"4"},{default:i(()=>[l(_,{modelValue:a(s).client_id,"onUpdate:modelValue":t[10]||(t[10]=r=>a(s).client_id=r),items:R.value,"item-title":"email","item-value":"id",label:"Client","prepend-inner-icon":"tabler-user","persistent-placeholder":"",placeholder:"Choose..",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","items","rules"])]),_:1}),l(n,{cols:"12",md:"4"},{default:i(()=>[l(T,{modelValue:a(s).content,"onUpdate:modelValue":t[11]||(t[11]=r=>a(s).content=r),"prepend-inner-icon":"tabler-note",placeholder:"Content","persistent-placeholder":"",label:"Content",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12",md:"4"},{default:i(()=>[l(_,{modelValue:a(s).trigger_event,"onUpdate:modelValue":t[12]||(t[12]=r=>a(s).trigger_event=r),items:L,"prepend-inner-icon":"tabler-color-picker",label:"Trigger Event",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12",md:"4"},{default:i(()=>[l(P,{modelValue:a(s).visibility_start,"onUpdate:modelValue":t[13]||(t[13]=r=>a(s).visibility_start=r),"prepend-inner-icon":"tabler-calendar-check",placeholder:"Visibility Start","persistent-placeholder":"",label:"Visibility Start",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12",md:"4"},{default:i(()=>[l(P,{modelValue:a(s).visibility_end,"onUpdate:modelValue":t[14]||(t[14]=r=>a(s).visibility_end=r),"prepend-inner-icon":"tabler-calendar-check",placeholder:"Visibility End","persistent-placeholder":"",label:"Visibility End",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12",md:"4"},{default:i(()=>[l(_,{modelValue:a(s).status,"onUpdate:modelValue":t[15]||(t[15]=r=>a(s).status=r),items:O,"prepend-inner-icon":"tabler-color-picker",label:"Status",rules:["requiredValidator"in e?e.requiredValidator:a(u)]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"12"},{default:i(()=>[l($,{type:"submit",disabled:y.value},{default:i(()=>[v(V(y.value?"Updating...":"Update"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"])):k("",!0)])]}),_:1}),l(n,{cols:"4",md:"4"},{default:i(()=>[l(T,{modelValue:a(U),"onUpdate:modelValue":t[17]||(t[17]=o=>I(U)?U.value=o:null),density:"compact",placeholder:"Search ...","append-inner-icon":"tabler-search","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(a(_e),{headers:ae,items:ee.value,search:a(U),"items-per-page":5,class:"text-no-wrap mb-4"},{"item.popup.client":i(({item:o})=>{var r,h,D,J;return[m("div",ye,[m("div",null,[l(ge,{rounded:"",src:((h=(r=o.client)==null?void 0:r.image)==null?void 0:h.length)>0?(D=o.client)==null?void 0:D.image:"/placeholder.jpg",height:"40",width:"40"},null,8,["src"])]),m("div",he,[m("span",ke,V((J=o.client)==null?void 0:J.name),1),m("span",Ce,V(o.client.designation),1)])])]}),"item.popup.content":i(({item:o})=>[m("span",Me,V(o==null?void 0:o.content.substring(0,35))+" "+V((o==null?void 0:o.content.length)>35?"...":""),1)]),"item.popup.trigger_event":i(({item:o})=>[m("span",Ue,V(o.trigger_event),1)]),"item.popup.visibility_start":i(({item:o})=>[m("span",qe,V(o!=null&&o.visibility_start?a(K)(o==null?void 0:o.visibility_start).format("DD MMM yyyy"):" - "),1)]),"item.popup.visibility_end":i(({item:o})=>[m("span",Pe,V(o!=null&&o.visibility_end?a(K)(o==null?void 0:o.visibility_end).format("DD MMM yyyy"):"-"),1)]),"item.popup.status":i(({item:o})=>[o.status==="Active"?(p(),c(N,{key:0,color:"success"},{default:i(()=>[v("Active")]),_:1})):o.status==="Scheduled"?(p(),c(N,{key:1,color:"primary"},{default:i(()=>[v("Scheduled")]),_:1})):o.status==="InActive"?(p(),c(N,{key:2,color:"error"},{default:i(()=>[v("InActive")]),_:1})):k("",!0)]),"item.popup.action":i(({item:o})=>{var r,h;return[(r=a(C).PopUpMessages)!=null&&r.includes("UpdatePopUpMessages")?(p(),c(H,{key:0,onClick:D=>le(o)},{default:i(()=>[l(Z,{activator:"parent",location:"top"},{default:i(()=>[v("Update")]),_:1}),l(B,{icon:"tabler-edit"})]),_:2},1032,["onClick"])):k("",!0),(h=a(C).PopUpMessages)!=null&&h.includes("DeletePopUpMessages")?(p(),c(H,{key:1,onClick:D=>ne(o.id)},{default:i(()=>[l(Z,{activator:"parent",location:"top"},{default:i(()=>[v("Delete")]),_:1}),l(B,{icon:"tabler-trash"})]),_:2},1032,["onClick"])):k("",!0)]}),_:1},8,["items","search"])]),_:1})]),_:1}))]),_:1})}}};export{ft as default};
