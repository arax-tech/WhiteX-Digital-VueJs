import{r as L}from"./validators-dea6e3a5.js";import{q as Y,L as K,a4 as Q,s as v,t as y,r as h,a as W,o as i,f as c,e,b as s,z as n,a2 as k,d as l,G as m,c as x,H as V,E as S,a1 as A,ag as X,D as Z}from"./index-670bda14.js";import{_ as tt}from"./AppSelect-b4b316a2.js";import{_ as et}from"./DialogCloseBtn-07a65624.js";import{_ as st}from"./AppTextField-803105de.js";import{_ as ot}from"./Loading-0e8ee1a0.js";import{h as at}from"./moment-a9aaa855.js";import{a as D,V as B}from"./VRow-44af3a5b.js";import{V as M}from"./VCardText-83b6dd60.js";import{V as nt}from"./VDataTable-674b624c.js";import{V as lt}from"./VImg-4f1dd734.js";import{V as T}from"./VTooltip-4a06c0c7.js";import{V as it}from"./VDialog-e50ee805.js";import{V as $}from"./VCard-367227de.js";import{V as rt}from"./VDivider-964da8ec.js";import"./helpers-61e4df1a.js";import"./focus-bfe812d1.js";import"./VSelect-80bd1ff2.js";import"./VTextField-babd124d.js";/* empty css                   */import"./VCounter-40602143.js";import"./VField-eebd85ff.js";import"./easing-9f15041e.js";import"./VInput-28c68c55.js";import"./form-f40ca62b.js";import"./forwardRefs-8348545e.js";import"./VList-faf63776.js";import"./ssrBoot-587632ee.js";import"./VAvatar-eedc1aa8.js";import"./dialog-transition-a3b422c0.js";import"./VMenu-cbe945a0.js";import"./VOverlay-9bca4c5f.js";import"./lazy-055ec9ba.js";import"./scopeId-78466d19.js";import"./VCheckboxBtn-770097af.js";import"./VSelectionControl-798a6484.js";import"./VChip-c9c9bc7b.js";import"./VTable-3015d60e.js";import"./filter-9f13f1fe.js";const ct=l("h2",null,"Subscription Cancellation Requests",-1),pt={class:"d-flex align-center"},ut={class:"d-flex flex-column ms-3"},dt={class:"d-block font-weight-medium text-truncate text-high-emphasis"},mt={class:"text-xs"},_t={class:"text-xs"},ft={key:0,style:{padding:"2px 10px"},class:"rounded bg-primary mr-1"},bt={key:1,style:{padding:"2px 10px"},class:"rounded bg-success mr-1"},ht={key:2,style:{padding:"2px 10px","background-color":"#c72c2c",color:"#fff"},class:"rounded bg-danger mr-1"},Vt={class:"text-xs"},gt=l("br",null,null,-1),le={__name:"requests",setup(Ct){const r=Y(),N=K(),q=Q.useToast();v(()=>document.title="Admin - Subscription Cancellation Requests"),v(()=>r.dispatch("GetSubscriptionCancellations"));const G=y(()=>r.state.subscriptionCancellations.cancellations),g=y(()=>r.state.subscriptionCancellations.loading),I=y(()=>r.state.auth.user),C=JSON.parse(I.value.permissions);v(()=>{var a;(a=C.CancellationRequests)!=null&&a.includes("ReadCancellationRequests")||(alert("You don't have permission to access this resource..."),N.go(-1))});const _=h(""),f=h(null),b=h(null),p=h(!1),P=a=>{p.value=!0,b.value=a},R=()=>{p.value=!1,b.value=null},E=[{title:"Client",key:"subscription.client"},{title:"Title",key:"subscription.title"},{title:"Description",key:"subscription.description"},{title:"Status",key:"subscription.status"},{title:"Date",key:"subscription.date"},{title:"Action",key:"subscription.action",sortable:!1}],F=async a=>{if(confirm("Are you sure to delete ?"))try{const o=await r.dispatch("DeleteSubscriptionCancellations",a);o.status===200&&(q.error(o.message),r.dispatch("GetSubscriptionCancellations"))}catch(o){console.log(o)}},O=async()=>{const a=new FormData;a.append("status",f.value);try{const o=await r.dispatch("UpdateSubscriptionCancellation",{id:b.value.id,formData:a});o.status===200&&(q.success(o.message),R(),r.dispatch("GetSubscriptionCancellations"))}catch(o){console.error(o)}},j=["Pending","Approved","Cancelled"];return(a,o)=>{const z=st,w=W("IconBtn"),H=et,J=tt;return i(),c(B,null,{default:e(()=>[g.value?(i(),c(ot,{key:0})):(i(),c(D,{key:1,cols:"12"},{default:e(()=>[s($,null,{default:e(()=>[s(M,{style:{"border-bottom":"thin solid rgba(var(--v-border-color), var(--v-border-opacity))"}},{default:e(()=>[s(B,null,{default:e(()=>[s(D,{cols:"8",md:"8"},{default:e(()=>[ct]),_:1}),s(D,{cols:"4",md:"4"},{default:e(()=>[s(z,{modelValue:n(_),"onUpdate:modelValue":o[0]||(o[0]=t=>k(_)?_.value=t:null),density:"compact",placeholder:"Search ...","append-inner-icon":"tabler-search","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(n(nt),{headers:E,items:G.value,search:n(_),"items-per-page":5,class:"text-no-wrap mb-4"},{"item.subscription.client":e(({item:t})=>{var u;return[l("div",pt,[l("div",null,[s(lt,{rounded:"",src:((u=t.user_image)==null?void 0:u.length)>0?t.user_image:"/placeholder.jpg",height:"40",width:"40"},null,8,["src"])]),l("div",ut,[l("span",dt,m(t.user_name),1)])])]}),"item.subscription.title":e(({item:t})=>[l("span",mt,m(t==null?void 0:t.title),1)]),"item.subscription.description":e(({item:t})=>[l("span",_t,m(t==null?void 0:t.description),1)]),"item.subscription.status":e(({item:t})=>[(t==null?void 0:t.status)==="Pending"?(i(),x("span",ft,"Pending")):(t==null?void 0:t.status)==="Approved"?(i(),x("span",bt,"Approved")):(t==null?void 0:t.status)==="Cancelled"?(i(),x("span",ht,"Cancelled")):V("",!0)]),"item.subscription.date":e(({item:t})=>[l("span",Vt,m(n(at)(t==null?void 0:t.created_at).format("DD MMM yyyy, hh:mm A")),1)]),"item.subscription.action":e(({item:t})=>{var u,U;return[(u=n(C).CancellationRequests)!=null&&u.includes("UpdateCancellationRequests")?(i(),c(w,{key:0,onClick:d=>P(t)},{default:e(()=>[s(T,{activator:"parent",location:"top"},{default:e(()=>[S("Update")]),_:1}),s(A,{icon:"tabler-edit"})]),_:2},1032,["onClick"])):V("",!0),(U=n(C).CancellationRequests)!=null&&U.includes("DeleteCancellationRequests")?(i(),c(w,{key:1,onClick:d=>F(t.id)},{default:e(()=>[s(T,{activator:"parent",location:"top"},{default:e(()=>[S("Delete")]),_:1}),s(A,{icon:"tabler-trash"})]),_:2},1032,["onClick"])):V("",!0),n(b)?(i(),c(it,{key:2,modelValue:n(p),"onUpdate:modelValue":o[2]||(o[2]=d=>k(p)?p.value=d:null),width:"600"},{default:e(()=>[s(H,{onClick:R}),s($,{title:"Update Subscription Cancellation"},{default:e(()=>[s(rt,{class:"mt-3"}),s(M,null,{default:e(()=>[l("form",{onSubmit:Z(O,["prevent"]),class:"p-2"},[s(J,{modelValue:n(f),"onUpdate:modelValue":o[1]||(o[1]=d=>k(f)?f.value=d:null),items:j,"prepend-inner-icon":"tabler-color-picker",label:"Status",rules:["requiredValidator"in a?a.requiredValidator:n(L)]},null,8,["modelValue","rules"]),gt,s(X,{type:"submit",disabled:g.value},{default:e(()=>[S(m(g.value?"Updating...":"Update"),1)]),_:1},8,["disabled"])],32)]),_:1})]),_:1})]),_:1},8,["modelValue"])):V("",!0)]}),_:1},8,["items","search"])]),_:1})]),_:1}))]),_:1})}}};export{le as default};
