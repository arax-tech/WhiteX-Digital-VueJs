import{r as J}from"./validators-dea6e3a5.js";import{q as L,L as I,a4 as T,s as v,t as C,r as V,o as l,f as k,e as o,b as a,d as t,ag as P,a1 as Y,E as $,D as Z,c as r,z as d,a2 as B,x as H,aj as K,C as F,G as S,F as b}from"./index-35d4c811.js";import{_ as Q}from"./AppSelect-676dfa2f.js";import{_ as W}from"./Loading-891177bd.js";import{C as g}from"./Permission-f91c8685.js";import{a as y,V as O}from"./VRow-d67d386c.js";import{V as R}from"./VCardText-20e2d0ff.js";import{V as X}from"./VDivider-4423ace3.js";import{V as N}from"./VForm-790819b5.js";import{V as ee}from"./VTable-41351eee.js";import{V as te}from"./VCard-06d56730.js";import"./helpers-61e4df1a.js";import"./focus-47cc4c1d.js";import"./VSelect-bf5a5be9.js";import"./VTextField-9bfa6dc1.js";/* empty css                   */import"./VCounter-dcd2da2a.js";import"./VImg-9b04c05e.js";import"./VField-4ee07b6e.js";import"./easing-9f15041e.js";import"./VInput-ff4d0189.js";import"./form-ff0dacbf.js";import"./forwardRefs-8348545e.js";import"./VList-56d7996c.js";import"./ssrBoot-c2946fb8.js";import"./VAvatar-7759ad5c.js";import"./dialog-transition-5411c7b8.js";import"./VMenu-d6c3699e.js";import"./VOverlay-ec7a9eab.js";import"./lazy-4836c696.js";import"./scopeId-d5f41359.js";import"./VCheckboxBtn-d7c7ca98.js";import"./VSelectionControl-4d8986cc.js";import"./VChip-5a7d2631.js";const se=t("div",null,[t("h2",null,"Create Client")],-1),oe={key:0},ae={style:{display:"flex","flex-direction":"row","align-items":"center","justify-content":"space-between"}},le=t("h2",{class:"mb-2"},"Permissions",-1),ie=t("label",{for:"checkAll"},"Â All Permission",-1),ne=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Modal"),t("th",{scope:"col"},"Create"),t("th",{scope:"col"},"Read"),t("th",{scope:"col"},"Update"),t("th",{scope:"col"},"Delete")])],-1),re={key:0},ce=["value","checked","onChange"],de={key:1},Ze={__name:"create",setup(ue){const c=L(),x=I(),j=T.useToast();v(()=>document.title="Admin - Create Client"),v(()=>c.dispatch("GetCustomers"));const w=C(()=>c.state.customers.loading),q=C(()=>c.state.customers.data),A=C(()=>c.state.clients.loading),M=C(()=>c.state.auth.user),U=JSON.parse(M.value.permissions);v(()=>{var e;(e=U.Client)!=null&&e.includes("CreateClient")||(alert("You don't have permission to access this resource..."),x.go(-1))});const u=V(""),p=V(),n=V({}),z=(e,s)=>{if(n.value.hasOwnProperty(e)){const h=n.value[e].indexOf(s);h!==-1?n.value[e].splice(h,1):n.value[e].push(s)}},D=()=>{for(const e in g)n.value[e]=f.value?g[e].permissions.slice():[]},f=V(!1);v(()=>{D()});const E=async()=>{const e=new FormData;e.append("email",`${u.value.id}--|--${u.value.email}`),e.append("permissions",JSON.stringify(n.value)),e.append("role","Client");try{const s=await c.dispatch("CreateClientAction",e);s.status===200&&(j.success(s.message),x.push("/admin/client"))}catch(s){console.error(s)}},G=()=>{var e;(e=p==null?void 0:p.value)==null||e.validate().then(({valid:s})=>{s&&E()})};return(e,s)=>{const h=Q;return l(),k(O,null,{default:o(()=>[w.value?(l(),k(W,{key:0})):(l(),k(y,{key:1,cols:"12"},{default:o(()=>[a(te,null,{default:o(()=>[a(R,{style:{display:"flex","flex-direction":"row","align-items":"center","justify-content":"space-between"}},{default:o(()=>[se,t("div",null,[a(P,{to:"/admin/client",rounded:"pill",color:"primary",size:"small",class:"ml-5"},{default:o(()=>[a(Y,{start:"",icon:"tabler-arrow-left"}),$("Back ")]),_:1})])]),_:1}),a(X),a(R,{class:"pt-0"},{default:o(()=>[a(N,{class:"mt-6",ref_key:"refForm",ref:p,onSubmit:Z(G,["prevent"])},{default:o(()=>[a(O,null,{default:o(()=>[a(y,{cols:"12",md:"12"},{default:o(()=>[w.value?(l(),r("div",oe)):(l(),k(h,{key:1,modelValue:d(u),"onUpdate:modelValue":s[0]||(s[0]=m=>B(u)?u.value=m:null),items:q.value,"item-title":"email","item-value":"email",label:"Client","prepend-inner-icon":"tabler-user","persistent-placeholder":"","return-object":"",rules:["requiredValidator"in e?e.requiredValidator:d(J)]},null,8,["modelValue","items","rules"]))]),_:1}),a(y,{cols:"12",md:"12",class:"mt-6"},{default:o(()=>[t("div",ae,[le,t("div",null,[H(t("input",{id:"checkAll",type:"checkbox","onUpdate:modelValue":s[1]||(s[1]=m=>B(f)?f.value=m:null),onChange:D},null,544),[[K,d(f)]]),ie])]),a(ee,{class:"text-no-wrap rounded border"},{default:o(()=>[ne,t("tbody",null,[(l(!0),r(b,null,F(d(g),(m,i)=>(l(),r("tr",{key:i},[t("td",null,S(i.replace(/([a-z])([A-Z])/g,"$1 $2")),1),(l(),r(b,null,F(["Create","Read","Update","Delete"],_=>(l(),r(b,null,[m.permissions.includes(_+i)?(l(),r("td",re,[t("input",{type:"checkbox",value:_+i,class:"checkbox",checked:d(n)[i]&&d(n)[i].includes(_+i),onChange:me=>z(i,_+i)},null,40,ce)])):(l(),r("td",de))],64))),64))]))),128))])]),_:1})]),_:1}),a(y,{cols:"12"},{default:o(()=>[a(P,{type:"submit",disabled:A.value},{default:o(()=>[$(S(A.value?"Creating...":"Create"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1}))]),_:1})}}};export{Ze as default};
